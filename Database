package com.example.database;

import androidx.appcompat.app.AppCompatActivity;
import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;
import android.database.sqlite.SQLiteOpenHelper;
import android.content.ContentValues;
import android.content.Context;
import android.os.Bundle;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.Toast;

public class MainActivity extends AppCompatActivity {

    EditText etName, etDept;
    Button btnInsert, btnView, btnSearch, btnUpdate, btnDelete;
    TextView tvResult;
    MyDBHelper db;
    int selectedId = -1; // store the ID of the selected student

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        etName = findViewById(R.id.etName);
        etDept = findViewById(R.id.etDept);
        btnInsert = findViewById(R.id.btnInsert);
        btnView = findViewById(R.id.btnView);
        btnSearch = findViewById(R.id.btnSearch);
        btnUpdate = findViewById(R.id.btnUpdate);
        btnDelete = findViewById(R.id.btnDelete);
        tvResult = findViewById(R.id.tvResult);

        db = new MyDBHelper(this);

        btnInsert.setOnClickListener(v -> insertData());
        btnView.setOnClickListener(v -> viewAll());
        btnSearch.setOnClickListener(v -> searchData());
        btnUpdate.setOnClickListener(v -> updateData());
        btnDelete.setOnClickListener(v -> deleteData());
    }

    private void insertData() {
        String name = etName.getText().toString().trim();
        String dept = etDept.getText().toString().trim();

        if (name.isEmpty() || dept.isEmpty()) {
            Toast.makeText(this, "Fill both fields!", Toast.LENGTH_SHORT).show();
            return;
        }

        boolean inserted = db.insertData(name, dept);
        Toast.makeText(this, inserted ? "Inserted!" : "Error inserting!", Toast.LENGTH_SHORT).show();
        etName.setText("");
        etDept.setText("");
        selectedId = -1;
    }

    private void viewAll() {
        Cursor res = db.getAllData();

        if (res.getCount() == 0) {
            tvResult.setText("No data found!");
            return;
        }

        StringBuilder allData = new StringBuilder();
        while (res.moveToNext()) {
            allData.append("ID: ").append(res.getInt(0)).append("\n")
                    .append("Name: ").append(res.getString(1)).append("\n")
                    .append("Dept: ").append(res.getString(2)).append("\n\n");
        }

        tvResult.setText(allData.toString());
        res.close();
    }

    private void searchData() {
        String keyword = etName.getText().toString().trim();
        if (keyword.isEmpty()) keyword = etDept.getText().toString().trim();

        if (keyword.isEmpty()) {
            Toast.makeText(this, "Enter Name or Dept to search!", Toast.LENGTH_SHORT).show();
            return;
        }

        Cursor res = db.getDataByNameOrDept(keyword);
        if (res.getCount() == 0) {
            tvResult.setText("No matching records found!");
            selectedId = -1;
            res.close();
            return;
        }

        res.moveToFirst();
        selectedId = res.getInt(0);
        etName.setText(res.getString(1));
        etDept.setText(res.getString(2));

        StringBuilder result = new StringBuilder();
        do {
            result.append("ID: ").append(res.getInt(0)).append("\n")
                    .append("Name: ").append(res.getString(1)).append("\n")
                    .append("Dept: ").append(res.getString(2)).append("\n\n");
        } while (res.moveToNext());

        tvResult.setText(result.toString());
        res.close();
    }

    private void updateData() {
        if (selectedId == -1) {
            Toast.makeText(this, "Search a student first!", Toast.LENGTH_SHORT).show();
            return;
        }

        String name = etName.getText().toString().trim();
        String dept = etDept.getText().toString().trim();

        boolean updated = db.updateData(selectedId, name, dept);
        Toast.makeText(this, updated ? "Updated!" : "Error updating!", Toast.LENGTH_SHORT).show();
        etName.setText("");
        etDept.setText("");
        selectedId = -1;
    }

    private void deleteData() {
        if (selectedId == -1) {
            Toast.makeText(this, "Search a student first!", Toast.LENGTH_SHORT).show();
            return;
        }

        boolean deleted = db.deleteData(selectedId);
        Toast.makeText(this, deleted ? "Deleted!" : "Error deleting!", Toast.LENGTH_SHORT).show();
        etName.setText("");
        etDept.setText("");
        selectedId = -1;
    }

    // -------- DATABASE HELPER CLASS --------
    class MyDBHelper extends SQLiteOpenHelper {

        public MyDBHelper(Context context) {
            super(context, "DeptDB", null, 1);
        }

        @Override
        public void onCreate(SQLiteDatabase db) {
            db.execSQL(
                    "CREATE TABLE student (" +
                            "id INTEGER PRIMARY KEY AUTOINCREMENT," +
                            "name TEXT," +
                            "dept TEXT)"
            );
        }

        @Override
        public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
            db.execSQL("DROP TABLE IF EXISTS student");
            onCreate(db);
        }

        public boolean insertData(String name, String dept) {
            SQLiteDatabase db = this.getWritableDatabase();
            ContentValues cv = new ContentValues();
            cv.put("name", name);
            cv.put("dept", dept);

            long result = db.insert("student", null, cv);
            return result != -1;
        }

        public boolean updateData(int id, String name, String dept) {
            SQLiteDatabase db = this.getWritableDatabase();
            ContentValues cv = new ContentValues();
            cv.put("name", name);
            cv.put("dept", dept);
            int result = db.update("student", cv, "id=?", new String[]{String.valueOf(id)});
            return result > 0;
        }

        public boolean deleteData(int id) {
            SQLiteDatabase db = this.getWritableDatabase();
            int result = db.delete("student", "id=?", new String[]{String.valueOf(id)});
            return result > 0;
        }

        public Cursor getDataByNameOrDept(String keyword) {
            SQLiteDatabase db = this.getReadableDatabase();
            return db.rawQuery(
                    "SELECT * FROM student WHERE name=? OR dept=?",
                    new String[]{keyword, keyword}
            );
        }

        public Cursor getAllData() {
            SQLiteDatabase db = this.getReadableDatabase();
            return db.rawQuery("SELECT * FROM student", null);
        }
    }
}















<?xml version="1.0" encoding="utf-8"?>
<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <LinearLayout
        android:orientation="vertical"
        android:padding="16dp"
        android:layout_width="match_parent"
        android:layout_height="wrap_content">

        <EditText
            android:id="@+id/etName"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:hint="Enter Name"
            android:inputType="textPersonName"
            android:layout_marginBottom="10dp"/>

        <EditText
            android:id="@+id/etDept"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:hint="Enter Dept"
            android:inputType="text"
            android:layout_marginBottom="20dp"/>

        <LinearLayout
            android:orientation="horizontal"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="10dp">

            <Button
                android:id="@+id/btnInsert"
                android:layout_width="0dp"
                android:layout_weight="1"
                android:layout_height="wrap_content"
                android:text="Insert"/>

            <Button
                android:id="@+id/btnView"
                android:layout_width="0dp"
                android:layout_weight="1"
                android:layout_height="wrap_content"
                android:text="View"/>
        </LinearLayout>

        <LinearLayout
            android:orientation="horizontal"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="20dp">

            <Button
                android:id="@+id/btnSearch"
                android:layout_width="0dp"
                android:layout_weight="1"
                android:layout_height="wrap_content"
                android:text="Search"/>

            <Button
                android:id="@+id/btnUpdate"
                android:layout_width="0dp"
                android:layout_weight="1"
                android:layout_height="wrap_content"
                android:text="Update"/>

            <Button
                android:id="@+id/btnDelete"
                android:layout_width="0dp"
                android:layout_weight="1"
                android:layout_height="wrap_content"
                android:text="Delete"/>
        </LinearLayout>

        <TextView
            android:id="@+id/tvResult"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="Results will appear here"
            android:textSize="16sp"
            android:padding="10dp"
            android:background="#f0f0f0"/>
    </LinearLayout>
</ScrollView>
